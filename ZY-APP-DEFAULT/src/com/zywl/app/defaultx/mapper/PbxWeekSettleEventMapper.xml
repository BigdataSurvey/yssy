<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zywl.app.defaultx.mapper.PbxWeekSettleEventMapper">

    <resultMap id="BaseResultMap" type="com.zywl.app.base.bean.PbxWeekSettleEvent">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="game_id"      property="gameId"      jdbcType="INTEGER"/>
        <result column="week_key"     property="weekKey"     jdbcType="VARCHAR"/>
        <result column="user_id"      property="userId"      jdbcType="BIGINT"/>
        <result column="rank"         property="rank"        jdbcType="INTEGER"/>
        <result column="bet_cents"    property="betCents"    jdbcType="BIGINT"/>
        <result column="rate"         property="rate"        jdbcType="DECIMAL"/>
        <result column="award_cents"  property="awardCents"  jdbcType="BIGINT"/>
        <result column="capital_type" property="capitalType" jdbcType="INTEGER"/>
        <result column="order_no"     property="orderNo"     jdbcType="VARCHAR"/>
        <result column="em"           property="em"          jdbcType="INTEGER"/>
        <result column="table_name"   property="tableName"   jdbcType="VARCHAR"/>
        <result column="status"       property="status"      jdbcType="INTEGER"/>
        <result column="fail_msg"     property="failMsg"     jdbcType="VARCHAR"/>
        <result column="create_time"  property="createTime"  jdbcType="TIMESTAMP"/>
        <result column="update_time"  property="updateTime"  jdbcType="TIMESTAMP"/>
    </resultMap>

    <sql id="Base_Column_List">
        id, game_id, week_key, user_id, `rank`, bet_cents, rate, award_cents, capital_type,
        order_no, em, table_name, status, fail_msg, create_time, update_time
    </sql>

    <insert id="insert" parameterType="com.zywl.app.base.bean.PbxWeekSettleEvent" useGeneratedKeys="true" keyProperty="id">
        insert into t_pbx_week_settle_event(
            game_id, week_key, user_id,
            `rank`, bet_cents, rate, award_cents,
            capital_type, order_no, em, table_name,
            status, fail_msg,
            create_time, update_time
        ) values (
                     #{gameId}, #{weekKey}, #{userId},
                     #{rank}, #{betCents}, #{rate}, #{awardCents},
                     #{capitalType}, #{orderNo}, #{em}, #{tableName},
                     #{status}, #{failMsg},
                     #{createTime}, #{updateTime}
                 )
    </insert>

    <insert id="insertIgnore" parameterType="com.zywl.app.base.bean.PbxWeekSettleEvent">
        insert ignore into t_pbx_week_settle_event(
            game_id, week_key, user_id,
            `rank`, bet_cents, rate, award_cents,
            capital_type, order_no, em, table_name,
            status, fail_msg,
            create_time, update_time
        ) values (
        #{gameId}, #{weekKey}, #{userId},
        #{rank}, #{betCents}, #{rate}, #{awardCents},
        #{capitalType}, #{orderNo}, #{em}, #{tableName},
        #{status}, #{failMsg},
        #{createTime}, #{updateTime}
        )
    </insert>

    <update id="update" parameterType="com.zywl.app.base.bean.PbxWeekSettleEvent">
        update t_pbx_week_settle_event
        set `rank`      = #{rank},
            bet_cents   = #{betCents},
            rate        = #{rate},
            award_cents = #{awardCents},
            capital_type= #{capitalType},
            order_no    = #{orderNo},
            em          = #{em},
            table_name  = #{tableName},
            status      = #{status},
            fail_msg    = #{failMsg},
            update_time = #{updateTime}
        where id = #{id}
    </update>

    <select id="findByWeekKey" parameterType="map" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM t_pbx_week_settle_event
        WHERE week_key = #{weekKey}
        ORDER BY `rank` ASC
    </select>

    <select id="findByUserId" parameterType="map" resultMap="BaseResultMap">
        SELECT <include refid="Base_Column_List"/>
        FROM t_pbx_week_settle_event
        WHERE user_id = #{userId}
        ORDER BY create_time DESC
    </select>

    <select id="findByGameWeek" parameterType="map" resultMap="BaseResultMap">
        select *
        from t_pbx_week_settle_event
        where game_id = #{gameId}
          and week_key = #{weekKey}
        order by `rank` asc
    </select>

    <select id="findByGameWeekUser" parameterType="map" resultMap="BaseResultMap">
        select *
        from t_pbx_week_settle_event
        where game_id = #{gameId}
          and week_key = #{weekKey}
          and user_id = #{userId}
            limit 1
    </select>

    <select id="findByOrderNo" parameterType="map" resultMap="BaseResultMap">
        select *
        from t_pbx_week_settle_event
        where order_no = #{orderNo}
            limit 1
    </select>

</mapper>